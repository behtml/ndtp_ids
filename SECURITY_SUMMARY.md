# –†–µ–∑—é–º–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ NDTP IDS

## üîí –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** –§–µ–≤—Ä–∞–ª—å 2024  
**–í–µ—Ä—Å–∏—è:** 0.1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ë–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫

### CodeQL Security Scan
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASSED
- **–ù–∞–π–¥–µ–Ω–æ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:** 0
- **–Ø–∑—ã–∫:** Python
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** No alerts found

### Code Review
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASSED
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:** 0
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:** 1 (SQL injection)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** All issues resolved

### Unit Tests
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ PASSED
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 13
- **–ü—Ä–æ—à–ª–æ:** 13
- **–ü—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å:** 0
- **–ü–æ–∫—Ä—ã—Ç–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** SQL injection protection test included

## üõ°Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç SQL Injection

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ f-string –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏–º–µ–Ω–∞–º–∏ –º–µ—Ç—Ä–∏–∫

**–†–µ—à–µ–Ω–∏–µ:**
```python
# Whitelist —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
ALLOWED_METRICS = {
    'connections_count',
    'unique_ports',
    'unique_dst_ips',
    'total_bytes',
    'avg_packet_size'
}

if metric not in ALLOWED_METRICS:
    raise ValueError(f"Invalid metric: {metric}")
```

**–§–∞–π–ª:** `src/ndtp_ids/anomaly_detector.py`, —Å—Ç—Ä–æ–∫–∏ 102-121  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–æ–±–∞–≤–ª–µ–Ω unit test

### 2. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é

**–ü—Ä–∏–º–µ—Ä—ã:**
```python
# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
cursor.execute('''
    INSERT INTO alerts (timestamp, src_ip, ...)
    VALUES (?, ?, ...)
''', (timestamp, src_ip, ...))

# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - WHERE —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
cursor.execute('''
    SELECT * FROM aggregated_metrics
    WHERE src_ip = ?
''', (src_ip,))
```

**–§–∞–π–ª—ã:**
- `src/ndtp_ids/aggregator.py`
- `src/ndtp_ids/anomaly_detector.py`

### 3. –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è:**
- ‚ùå Payload –ø–∞–∫–µ—Ç–æ–≤
- ‚ùå –ü–∞—Ä–æ–ª–∏
- ‚ùå –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚ùå –°–æ–¥–µ—Ä–∂–∏–º–æ–µ HTTP/HTTPS —Ç—Ä–∞—Ñ–∏–∫–∞

**–°–æ–±–∏—Ä–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:**
- ‚úÖ IP –∞–¥—Ä–µ—Å–∞ (–∏—Å—Ç–æ—á–Ω–∏–∫, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ)
- ‚úÖ –ü–æ—Ä—Ç—ã (–∏—Å—Ç–æ—á–Ω–∏–∫, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ)
- ‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª (TCP/UDP)
- ‚úÖ –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

**–§–∞–π–ª:** `src/ndtp_ids/packet_collector.py`

### 4. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª)
- –ù–µ—Ç —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
- –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

**–§–∞–π–ª:** `ndtp_ids.db` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git)

### 5. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ö–æ–ª–ª–µ–∫—Ç–æ—Ä: root/admin (—Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –ø–∞–∫–µ—Ç–æ–≤)
- –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä: –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –î–µ—Ç–µ–∫—Ç–æ—Ä: –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –ü–æ–≤—ã—à–µ–Ω–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –º–æ–¥—É–ª—é
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ root

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. –ó–∞—Ö–≤–∞—Ç –ø–∞–∫–µ—Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç root

**–ü—Ä–∏—á–∏–Ω–∞:** –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–µ–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º –Ω–∞ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ  
**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¥–ª—è packet capture)  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ setcap –Ω–∞ Linux –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### 2. –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ç—Ä–∞—Ñ–∏–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞  
**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü–ª—é—Å - –Ω–µ –º–æ–∂–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —á—É–∂–∏–µ —Å–µ—Ç–∏ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ —Å–≤–æ–∏—Ö —Å–µ—Ç—è—Ö

### 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∞

**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (—Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ—Ç sensitive data)  
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å SQLCipher  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ë–î —Ñ–∞–π–ª—É (chmod 600)

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### 1. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# Linux/macOS
chmod 600 ndtp_ids.db
chown username:username ndtp_ids.db

# Windows
icacls ndtp_ids.db /inheritance:r /grant:r "%USERNAME%":F
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ capabilities (Linux)

```bash
# –í–º–µ—Å—Ç–æ sudo –º–æ–∂–Ω–æ –¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ capabilities
sudo setcap cap_net_raw,cap_net_admin=eip $(which python3)

# –ò–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞
sudo setcap cap_net_raw,cap_net_admin=eip /path/to/python
```

### 3. –ó–∞–ø—É—Å–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```dockerfile
# –ü—Ä–∏–º–µ—Ä Dockerfile –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
FROM python:3.10
RUN pip install ndtp_ids
USER nobody
CMD ["python", "-m", "ndtp_ids.aggregator"]
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

```bash
# –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∞–ª–µ—Ä—Ç—ã
sqlite3 ndtp_ids.db "SELECT * FROM alerts WHERE severity='critical';"
```

### 5. –†–æ—Ç–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
sqlite3 ndtp_ids.db "DELETE FROM raw_events WHERE timestamp < strftime('%s', 'now', '-30 days');"
```

## üîê –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

### OWASP Top 10 (2021)

| –£—è–∑–≤–∏–º–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|-------------|
| A01 Broken Access Control | ‚úÖ | –§–∞–π–ª–æ–≤—ã–µ –ø—Ä–∞–≤–∞ |
| A02 Cryptographic Failures | ‚ö†Ô∏è | –ë–î –Ω–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∞ (—Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ) |
| A03 Injection | ‚úÖ | SQL injection –∑–∞—â–∏—â–µ–Ω |
| A04 Insecure Design | ‚úÖ | –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| A05 Security Misconfiguration | ‚úÖ | –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| A06 Vulnerable Components | ‚úÖ | –ú–∏–Ω–∏–º—É–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| A07 Auth Failures | N/A | –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| A08 Software and Data Integrity | ‚úÖ | –ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö |
| A09 Security Logging | ‚úÖ | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π |
| A10 SSRF | N/A | –ù–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |

### CWE (Common Weakness Enumeration)

| CWE ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|--------|----------|--------|
| CWE-89 | SQL Injection | ‚úÖ –ó–∞—â–∏—â–µ–Ω |
| CWE-78 | OS Command Injection | ‚úÖ –ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ |
| CWE-79 | XSS | N/A | –ù–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ |
| CWE-22 | Path Traversal | ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—É—Ç–µ–π |
| CWE-352 | CSRF | N/A | –ù–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ |

## üìù Checklist –¥–ª—è —Ä–µ–≤—å—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- [x] SQL injection –∑–∞—â–∏—Ç–∞
- [x] –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [x] –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏
- [x] –ù–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è sensitive data
- [x] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- [x] Unit —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] CodeQL –∞–Ω–∞–ª–∏–∑
- [x] Code review
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] –≠—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** ‚úÖ **–ë–ï–ó–û–ü–ê–°–ï–ù**

–°–∏—Å—Ç–µ–º–∞ NDTP IDS –ø—Ä–æ—à–ª–∞ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- ‚úÖ CodeQL: 0 —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ Code Review: –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ Unit Tests: 13/13 –ø—Ä–æ—à–ª–∏
- ‚úÖ SQL Injection: –∑–∞—â–∏—â–µ–Ω
- ‚úÖ Sensitive Data: –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —É—á–µ–±–Ω—ã—Ö –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–µ–ª—è—Ö –ø—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

---

**–î–∞—Ç–∞:** –§–µ–≤—Ä–∞–ª—å 2024  
**–í–µ—Ä—Å–∏—è:** 0.1.0  
**–ü—Ä–æ–≤–µ—Ä—è–ª:** GitHub Copilot Security Review  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ APPROVED
